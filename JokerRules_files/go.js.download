!function(){var t={p:""};StackExchange=window.StackExchange=window.StackExchange||{},StackOverflow=window.StackOverflow=window.StackOverflow||{},t.p=document.getElementById("webpack-public-path").innerText,StackExchange=window.StackExchange=window.StackExchange||{},StackOverflow=window.StackOverflow=window.StackOverflow||{},window.BambooJoint=function(){if(!document.createElement("canvas").getContext)return{render:function(){return null}};!function(t){var n;n=Array.prototype.indexOf?function(t,n){return t.indexOf(n)}:function(t,n){for(var e=t.length,r=0;r<e;r++)if(r in t&&t[r]===n)return r;return-1};var e={},r=function(t){if(!(this instanceof r))return new r(t);this.forEach="function"==typeof t?a(t):t.constructor===Array?c(t):f(t)},o=function(){throw e},i=function(t){this.message=t,this.name="IterationError"};i.prototype=Error.prototype;var a=function(t){return function(n,a){var c=!1,f=0,u=function(t){if(c)throw new i("yield after end of iteration");return t=n.call(a,t,f,o),f++,t};try{t(u,(function(t){(t=t instanceof r?t:new r(t)).forEach((function(t){u(t)}))}),o)}catch(t){if(t!==e)throw t}finally{c=!0}}},c=function(t){return a((function(n){for(var e=t.length,r=0;r<e;r++)r in t&&n(t[r])}))},f=function(t){return a((function(n){for(var e in t)t.hasOwnProperty(e)&&n([e,t[e]])}))},u=function(t){return"string"==typeof t?function(n){return n[t]}:t};r.prototype={toArray:function(){var t=[];return this.forEach((function(n){t.push(n)})),t},filter:function(t,n){var e=this;return t=u(t),new r((function(r){e.forEach((function(e){t.call(n,e)&&r(e)}))}))},take:function(t){var n=this;return new r((function(e){n.forEach((function(n,r,o){r>=t&&o(),e(n)}))}))},skip:function(t){var n=this;return new r((function(e){n.forEach((function(n,r){r>=t&&e(n)}))}))},map:function(t,n){var e=this;return t=u(t),new r((function(r){e.forEach((function(e){r(t.call(n,e))}))}))},zipWithArray:function(t,n){void 0===n&&(n=function(t,n){return[t,n]});var e=this;return new r((function(r){var o=t.length,i=0;e.forEach((function(e,a,c){for(;!(a+i in t)&&a+i<o;)i++;a+i>=o&&c(),r(n(e,t[a+i]))}))}))},reduce:function(t,n){var e,r;return 2>arguments.length?e=!0:(e=!1,r=n),this.forEach((function(n){e?(r=n,e=!1):r=t(r,n)})),r},and:function(t){var n=this;return new r((function(e,r){r(n),r(t)}))},takeWhile:function(t){var n=this;return t=u(t),new r((function(e){n.forEach((function(n,r,o){t(n)?e(n):o()}))}))},skipWhile:function(t){var n=this;return t=u(t),new r((function(e){var r=!0;n.forEach((function(n){(r=r&&t(n))||e(n)}))}))},all:function(t){var n=!0;return t=u(t),this.forEach((function(e,r,o){(t?t(e):e)||(n=!1,o())})),n},any:function(t){var n=!1;return t=u(t),this.forEach((function(e,r,o){(t?t(e):e)&&(n=!0,o())})),n},first:function(){var t;return this.forEach((function(n,e,r){t=n,r()})),t},groupBy:function(t){var e=this;return t=u(t),new r((function(o,i){var a=[],c=[];e.forEach((function(e){var r=t(e),o=n(a,r);-1===o?(a.push(r),c.push([e])):c[o].push(e)})),i(new r(a).zipWithArray(c,(function(t,n){var e=new r(n);return e.key=t,e})))}))},evaluated:function(){return new r(this.toArray())},except:function(t){return this.filter((function(n){return n!==t}))},sortBy:function(t){var n=this;return t=u(t),new r((function(e){var o=n.toArray(),i=h(0,o.length).toArray();i.sort((function(n,e){var r=t(o[n]),i=t(o[e]);if(typeof r==typeof i){if(r===i)return n<e?-1:1;if(r<i)return-1;if(r>i)return 1}throw new TypeError("cannot compare "+r+" and "+i)})),new r(i).forEach((function(t){e(o[t])}))}))},count:function(){var t=0;return this.forEach((function(){t++})),t}};var l=function(t,n){var e=t;return void 0===n&&(n=1),new r((function(t){for(;;)t(e),e+=n}))},h=function(t,n){return l(t,1).take(n)},s=t.Generator;t.Generator=r,r.BreakIteration=e,r.Count=l,r.Range=h,r.IterationError=i,r.noConflict=function(){return t.Generator=s,r}}(window),Generator=Generator.noConflict();var t={};function n(t,e){var r,o,i,a;"both"===t?(r=n("black",e),o="white",i=.5*Math.PI,a=1.5*Math.PI):((r=document.createElement("canvas")).width=29*e,r.height=29*e,o=t,i=0,a=2*Math.PI);var c=r.getContext("2d");c.save(),c.fillStyle=o,"both"!==t&&(c.shadowOffsetX=1*e,c.shadowOffsetY=1*e,c.shadowBlur=3*e,c.shadowColor="rgba(0,0,0,.7)"),c.beginPath(),c.arc(14.5*e,14.5*e,10*e,i,a,!1),c.fill(),c.restore(),c.save();var f=c.createRadialGradient(14.5*e,14.5*e,10*e,7.5*e,7.5*e,2*e),u="white"===o?"#e0e0e0":"black",l="black"===o?"#404040":"white";return f.addColorStop(0,u),f.addColorStop(.25,u),f.addColorStop(1,l),c.fillStyle=f,c.beginPath(),c.arc(14.5*e,14.5*e,10*e,i,a,!1),c.fill(),c.restore(),r}function e(t){var n=0|t;return n===t?t:n+1}function r(r,o){var i=o.scale,a=t[i]=t[i]||function(t){return{white:n("white",t),black:n("black",t),both:n("both",t)}}(i),c=22*(r.width+1)*i,f=22*(r.height+1)*i,u="#d3823b";r.coordinates&&(c+=6*i,f+=6*i),c=e(c),f=e(f);var l=document.createElement("canvas");l.width=c,l.height=f;var h=l.getContext("2d");function s(t,n,e){h.drawImage(a[e],t-14.5*i,n-14.5*i)}h.fillStyle=u,h.fillRect(0,0,c,f),h.lineWidth=1*i;var d=r.coordinates?28.5*i:22.5*i;if(Generator(r.board).forEach((function(t,n){Generator(t).forEach((function(e,o){var a=22*o*i+d,c=22*n*i+d,f=e.piece;if("_"!==f&&function(t,n,e,r,o,a){h.beginPath(),h.moveTo(t-(a?0:11*i),n),h.lineTo(t+(r?0:11*i),n),h.moveTo(t,n-(e?0:11*i)),h.lineTo(t,n+(o?0:11*i)),h.stroke()}(a,c,t.top,e.right,t.bottom,e.left),h.save(),/[OW@QP]/.test(f)?s(a,c,"white"):/[XB#YZ]/.test(f)&&s(a,c,"black"),/[BWC]/.test(f))!function(t,n){h.save(),h.lineWidth=2*i,h.strokeStyle="red",h.beginPath(),h.arc(t,n,5*i,0,2*Math.PI,!1),h.stroke(),h.restore()}(a,c);else if(/[#@S]/.test(f))!function(t,n){h.save(),h.fillStyle="red",h.fillRect(t-5*i,n-5*i,10*i,10*i),h.restore()}(a,c);else if(/[YQT]/.test(f))!function(t,n){h.save(),h.fillStyle="red",h.beginPath(),h.moveTo(t,n-6*i),h.lineTo(t+6*i,n+4*i),h.lineTo(t-6*i,n+4*i),h.closePath(),h.fill(),h.restore()}(a,c);else if(/[ZPM]/.test(f))!function(t,n){h.save(),h.strokeStyle="red",h.lineWidth=2*i,h.beginPath(),h.moveTo(t-5*i,n-5*i),h.lineTo(t+5*i,n+5*i),h.moveTo(t+5*i,n-5*i),h.lineTo(t-5*i,n+5*i),h.stroke(),h.restore()}(a,c);else if("*"===f)s(a,c,"both");else if(/^\d$/.test(f)){var l=parseInt(f,10);0===l&&(l=10);var v=l%2==1^r.whiteFirst;s(a,c,v?"black":"white"),h.font=12*i+"px sans-serif",h.textAlign="center",h.fillStyle=v?"white":"black",h.fillText(l+r.moveDelta,a,c+4*i)}else"?"===f?(h.fillStyle="rgba(255,255,255,0.5)",h.fillRect(a-11.5*i|0,c-11.5*i|0,(a+10.5*i|0)-(a-11.5*i|0),(c+10.5*i|0)-(c-11.5*i|0))):/^[a-z]$/.test(f)?(h.font="bold "+15*i+"px sans-serif",h.textAlign="center",h.fillStyle="black",h.lineWidth=6*i,h.strokeStyle=u,h.strokeText(f,a,c+5*i),h.fillText(f,a,c+5*i),h.lineWidth=1*i):","===f&&(h.fillStyle="black",h.beginPath(),h.arc(a,c,2.5*i,0,2*Math.PI,!1),h.fill());h.restore()}))})),r.coordinates){h.save(),h.fillStyle="#6b421e",h.font=10*i+"px sans-serif";for(var v=0;v<r.height;v++)h.textAlign="right",h.fillText(r.topCoordinate-v+1,16*i,(22*v+31.5)*i);for(var w=0;w<r.width;w++){h.textAlign="center";var p=r.leftCoordinate+w+1;p>=9&&p++,h.fillText(String.fromCharCode(64+p),(22*w+28.5)*i,12*i)}h.restore()}return{canvas:l,width:c,height:f}}return{render:function(t,n){(n=n||{}).scale=n.scale||1;var e=function(t){t=t.replace(/\r/g,"\n");var n=Generator(t.split(/\n+/)).filter((function(t){return/\S/.test(t)})).evaluated(),e={board:[]},r=e.board;if(n.any((function(t){return!/^\$\$/.test(t)})))return null;var o,i,a=n.first();if(!a)return null;e.moveDelta=0,a.replace(/^\$\$(([BW]?)(c?)(\d*)(?:m(\d+))?)(?:\s+(.*)|)$/,(function(t,r,i,a,c,f,u){if(u=(u||"").replace(/\s+$/,""),!r.length){if(!u.length)return;if(!/[^\sOW@QPXB#YZCSTM\d?a-z,*+|_-]/.test(u)&&!/\w{2} \w{2}/.test(u))return}e.whiteFirst="W"===i,o="c"===a;var l=parseInt(c,10);isFinite(l)&&(e.boardSize=l);var h=parseInt(f,10);isFinite(h)&&(e.moveDelta=h-1),e.caption=u,n=n.skip(1)})),n.forEach((function(t){if(/^\$\$\s(?:[|+-]\s*){2,}$/.test(t))return i&&(i.bottom=!0),r.length&&!r[r.length-1].length||(i=[],r.push(i)),void(r[r.length-1].top=!0);r.length&&!r[r.length-1].length||(i=[],r.push(i));var n,e=Generator((function(n){for(var e,r=t.length,o=0;o<r;o++)e=t.charAt(o),/[$\s]/.test(e)||n(e)})),o=!1;e.forEach((function(t){if(/[|+-]/.test(t))return n&&(n.right=!0),void(o=!0);var e={piece:t};o&&(e.left=!0),o=!1,i.push(e),n=e}))})),r.length&&!r[r.length-1].length&&r.pop();var c=0,f=0;if(!r.length)return null;var u=!1;if(c=Generator(r).map((function(t){return t.length})).reduce((function(t,n){return u=u||t!==n,Math.max(t,n)})),f=r.length,u)return null;if(o){var l=r[0][0].left,h=r[0][c-1].right,s=r[0].top,d=r[f-1].bottom,v=e.boardSize;v||(v=19,l&&h?v=c:s&&d&&(v=f)),l?e.leftCoordinate=0:h?e.leftCoordinate=v-c:o=!1,s?e.topCoordinate=v-1:d?e.topCoordinate=f-1:o=!1,o&&(e.coordinates=!0)}return e.width=c,e.height=f,e}(t);if(!e)return null;var o=r(e,n);return e.caption&&e.caption.length&&(o.caption=e.caption),o}}}(),$((function(){if($("<canvas />")[0].getContext){var t=1e3;!function n(){var e=function(t){var n=!1;return(t=t||$(document)).find(".js-post-body pre > code, .js-wmd-preview pre > code").each((function(){var t=$(this).text(),e=window.devicePixelRatio||1,r=BambooJoint.render(t,{scale:e});if(r){n=!0;var o=$("<div />");if($(r.canvas).appendTo(o).css({"max-width":630,display:"block",width:r.width/e,height:r.height/e}),o.css({width:r.width/e,maxWidth:630,backgroundColor:"#ffcfa4",padding:5,marginBottom:8,boxSizing:"content-box"}),$(this).parent().replaceWith(o),r.caption){var i=$("<span />").css({"font-size":"80%","line-height":1}).text(r.caption).appendTo(o);i.html(i.html().replace(/\\n/g,"<br />"))}}})),n}();!e&&t<1e4&&(t+=1e3),e&&(t=1e3),setTimeout(n,t)}()}}))}();